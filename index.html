<!DOCTYPE html>
<html lang="vi" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£n ƒë·ªì C√¥ng tr√¨nh T·ªïng C√¥ng ty 319</title>
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="319logo.png" sizes="32x32">
    <link rel="shortcut icon" href="319logo.png" type="image/x-icon">
    <link rel="apple-touch-icon" href="319logo.png">

    <!-- Meta tags for SEO and Social Sharing -->
    <meta name="description" content="H·ªá th·ªëng b·∫£n ƒë·ªì c√¥ng tr√¨nh T·ªïng C√¥ng ty 319 - Qu·∫£n l√Ω v√† theo d√µi c√°c c√¥ng tr√¨nh x√¢y d·ª±ng tr√™n to√†n qu·ªëc">
    <meta name="keywords" content="b·∫£n ƒë·ªì c√¥ng tr√¨nh, T·ªïng C√¥ng ty 319, x√¢y d·ª±ng, qu·∫£n l√Ω c√¥ng tr√¨nh, Vi·ªát Nam">
    <meta name="author" content="T·ªïng C√¥ng ty 319 - B·ªô Qu·ªëc ph√≤ng">

    <!-- Open Graph -->
    <meta property="og:title" content="B·∫£n ƒë·ªì C√¥ng tr√¨nh T·ªïng C√¥ng ty 319">
    <meta property="og:description" content="H·ªá th·ªëng qu·∫£n l√Ω v√† theo d√µi c√¥ng tr√¨nh x√¢y d·ª±ng tr√™n to√†n qu·ªëc">
    <meta property="og:type" content="website">

    <!-- Preload critical resources -->
    <link rel="preload" href="https://api.mapbox.com/mapbox-gl-js/v3.16.0/mapbox-gl.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="main.css" as="style">

    <!-- Mapbox GL JS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.16.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.16.0/mapbox-gl.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">

    <!-- Main Styles -->
    <link rel="stylesheet" href="main.css">

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://api.mapbox.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com/ajax/libs">
    <script>
        // Ki·ªÉm tra n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p th√¨ chuy·ªÉn h∆∞·ªõng
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
</head>

<body>
    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">ƒêang t·∫£i b·∫£n ƒë·ªì...</div>
    </div>

    <div class="app-container" role="main">
        <!-- Sidebar -->
        <aside class="sidebar" role="complementary" aria-label="Th√¥ng tin c√¥ng tr√¨nh">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon" aria-hidden="true">
                        <img src="319logo.png" alt="Logo T·ªïng C√¥ng ty 319" loading="lazy">
                    </div>
                    <div class="logo-text">T·ªîNG C√îNG TY 319 B·ªò QU·ªêC PH√íNG</div>
                </div>
                <div class="subtitle">H·ªá th·ªëng b·∫£n ƒë·ªì c√¥ng tr√¨nh tr√™n to√†n qu·ªëc</div>
            </div>

            <!-- Statistics Overview -->
            <section class="stats-overview" aria-label="Th·ªëng k√™ t·ªïng quan">
                <div class="stat-card">
                    <div class="stat-value" id="totalProjects" aria-live="polite">0</div>
                    <div class="stat-label">C√¥ng tr√¨nh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalProvinces" aria-live="polite">0</div>
                    <div class="stat-label">T·ªânh th√†nh</div>
                </div>

            </section>

            <!-- Search Section -->
            <section class="search-section" aria-label="T√¨m ki·∫øm c√¥ng tr√¨nh">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm c√¥ng tr√¨nh..." aria-label="T√¨m ki·∫øm c√¥ng tr√¨nh theo t√™n ho·∫∑c ƒë·ªãa ƒëi·ªÉm" autocomplete="off">
                    <div class="search-icon" aria-hidden="true">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

            </section>



            <!-- Filter Panel -->
            <section class="filter-panel" id="filterPanel" aria-label="B·ªô l·ªçc c√¥ng tr√¨nh" style="display: none;">
                <div class="filter-section">
                    <div class="filter-group">
                        <label>Lo·∫°i c√¥ng tr√¨nh:</label>
                        <div class="filter-options" id="typeFilters">
                            <label class="filter-checkbox">
                                <input type="checkbox" value="commercial" data-filter="type">
                                <span class="checkmark" style="border-color: #e74c3c"></span>
                                Th∆∞∆°ng m·∫°i
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="transport" data-filter="type">
                                <span class="checkmark" style="border-color: #3498db"></span>
                                Giao th√¥ng
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" value="industrial" data-filter="type">
                                <span class="checkmark" style="border-color: #2ecc71"></span>
                                C√¥ng nghi·ªáp
                            </label>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label>NƒÉm ho√†n th√†nh:</label>
                        <div class="year-range">
                            <input type="number" id="yearFrom" placeholder="T·ª´ nƒÉm" min="2000" max="2025">
                            <span>ƒë·∫øn</span>
                            <input type="number" id="yearTo" placeholder="ƒê·∫øn nƒÉm" min="2000" max="2025">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label>T·ªânh th√†nh:</label>
                        <select id="provinceFilter">
                            <option value="">T·∫•t c·∫£ t·ªânh th√†nh</option>
                        </select>
                    </div>

                    <div class="filter-actions">
                        <button class="filter-btn apply-filters">√Åp d·ª•ng</button>
                        <button class="filter-btn reset-filters">ƒê·∫∑t l·∫°i</button>
                    </div>
                </div>
            </section>

            <!-- Projects List -->
            <section class="projects-list" aria-label="Danh s√°ch c√¥ng tr√¨nh">
                <h2 class="projects-title">
                    <i class="fas fa-list-ul" aria-hidden="true"></i> Danh s√°ch c√¥ng tr√¨nh
                    <span class="sr-only">, s·ª≠ d·ª•ng ph√≠m tab ƒë·ªÉ di chuy·ªÉn gi·ªØa c√°c c√¥ng tr√¨nh</span>
                </h2>
                <div id="projectsList" role="list" aria-label="Danh s√°ch c√°c c√¥ng tr√¨nh">
                    <div class="projects-loading" aria-live="polite">ƒêang t·∫£i danh s√°ch c√¥ng tr√¨nh...</div>
                </div>
            </section>
        </aside>

        <!-- Main Map Container -->
        <main class="map-container" role="region" aria-label="B·∫£n ƒë·ªì c√¥ng tr√¨nh">
            <div id="map" role="application" aria-label="B·∫£n ƒë·ªì t∆∞∆°ng t√°c hi·ªÉn th·ªã c√°c c√¥ng tr√¨nh x√¢y d·ª±ng" tabindex="0">
                <!-- Map will be initialized by JavaScript -->
            </div>

            <!-- Map Controls -->
            <nav class="map-controls" aria-label="ƒêi·ªÅu khi·ªÉn b·∫£n ƒë·ªì">
                <button class="control-btn" id="zoomIn" title="Ph√≥ng to" aria-label="Ph√≥ng to b·∫£n ƒë·ªì">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                </button>
                <button class="control-btn" id="zoomOut" title="Thu nh·ªè" aria-label="Thu nh·ªè b·∫£n ƒë·ªì">
                    <i class="fas fa-minus" aria-hidden="true"></i>
                </button>
                <button class="control-btn" id="resetView" title="V·ªÅ v·ªã tr√≠ Vi·ªát Nam" aria-label="Tr·ªü v·ªÅ v·ªã tr√≠ m·∫∑c ƒë·ªãnh c·ªßa Vi·ªát Nam">
                    <i class="fas fa-home" aria-hidden="true"></i>
                </button>
                <button class="control-btn" id="toggleSatellite" title="Chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô v·ªá tinh" aria-label="Chuy·ªÉn ƒë·ªïi gi·ªØa ch·∫ø ƒë·ªô b·∫£n ƒë·ªì v√† ·∫£nh v·ªá tinh">
                    <i class="fas fa-satellite" aria-hidden="true"></i>
                </button>
                <button class="control-btn" id="themeToggle" title="Chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô s√°ng/t·ªëi" aria-label="Chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô s√°ng t·ªëi">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
                <div class="control-divider" aria-hidden="true"></div>

                <button class="control-btn" id="openLayers" title="M·ªü l·ªõp b·∫£n ƒë·ªì" aria-label="M·ªü b·∫£ng ƒëi·ªÅu khi·ªÉn l·ªõp b·∫£n ƒë·ªì">
                    <i class="fas fa-layer-group" aria-hidden="true"></i>
                </button>
                <button class="control-btn" id="openLegend" title="M·ªü ch√∫ gi·∫£i" aria-label="M·ªü b·∫£ng ch√∫ gi·∫£i m√†u s·∫Øc">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                </button>

                <button class="control-btn" id="openStats" title="M·ªü Dashboard" aria-label="M·ªü b·∫£ng th·ªëng k√™ c√¥ng tr√¨nh">
        <i class="fas fa-chart-bar" aria-hidden="true"></i>
    </button>
                <button class="control-btn" onclick="comparisonManager.openComparison()" id="openComparison" title="So s√°nh c√¥ng tr√¨nh" aria-label="So s√°nh c√¥ng tr√¨nh">
    <i class="fas fa-balance-scale"></i> 
</button>
                <div class="control-divider" aria-hidden="true"></div>

                <!-- ===== TH√äM N√öT ROUTE PLANNING ƒê·∫†Y ===== -->
                <button class="control-btn" id="openRouteBtn" title="T√≠nh To√°n Tuy·∫øn ƒê∆∞·ªùng">
        <i class="fas fa-road"></i>
    </button>
                <!-- ===== TH√äM N√öT FORM ƒê·∫†Y ===== -->
                <button class="control-btn" id="openFormBtn" title="Th√™m/S·ª≠a D·ª± √Ån">
        <i class="fas fa-plus-circle"></i>
        <!-- N√∫t n√†y s·∫Ω m·ªü modal form ƒë·ªÉ th√™m ho·∫∑c s·ª≠a d·ª± √°n -->
                <button class="control-btn toggle-controls" id="toggleControls" title="·∫®n/hi·ªán c√¥ng c·ª•" aria-label="·∫®n ho·∫∑c hi·ªán thanh c√¥ng c·ª• b·∫£n ƒë·ªì">
                    <i class="fas fa-chevron-left" aria-hidden="true"></i>
                </button>
            </nav>
            <!-- Map Overlay Panel -->
            <section class="map-overlay" id="mapOverlay" role="dialog" aria-labelledby="mapOverlayTitle" aria-hidden="true">
                <div class="overlay-header">
                    <h3 id="mapOverlayTitle"><i class="fas fa-layer-group" aria-hidden="true"></i> L·ªõp b·∫£n ƒë·ªì</h3>
                    <button class="close-overlay" id="closeOverlay" aria-label="ƒê√≥ng b·∫£ng l·ªõp b·∫£n ƒë·ªì">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="layer-control">
                    <input type="checkbox" id="satelliteLayer" checked aria-checked="true">
                    <label for="satelliteLayer">·∫¢nh v·ªá tinh</label>
                </div>
                <div class="layer-control">
                    <input type="checkbox" id="projectLayer" checked aria-checked="true">
                    <label for="projectLayer">ƒêi·ªÉm c√¥ng tr√¨nh</label>
                </div>
                <div class="layer-control">
                    <input type="checkbox" id="provinceLayer" checked aria-checked="true">
                    <label for="provinceLayer">Bi√™n gi·ªõi t·ªânh</label>
                </div>
                <!-- HEATMAP TOGGLE -->
                <div class="layer-control">
                    <input type="checkbox" id="heatmapLayer" aria-checked="false">
                    <label for="heatmapLayer">M·∫≠t ƒë·ªô c√¥ng tr√¨nh</label>
                </div>
            </section>

            <!-- Legend Panel -->
            <section class="legend" id="legend" role="dialog" aria-labelledby="legendTitle" aria-hidden="true">
                <div class="overlay-header">
                    <h3 id="legendTitle" class="legend-title">Ch√∫ gi·∫£i</h3>
                    <button class="close-overlay" id="closeLegend" aria-label="ƒê√≥ng b·∫£ng ch√∫ gi·∫£i">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;" aria-hidden="true"></div>
                    <div class="legend-label">C√¥ng tr√¨nh th∆∞∆°ng m·∫°i</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;" aria-hidden="true"></div>
                    <div class="legend-label">C√¥ng tr√¨nh giao th√¥ng</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2ecc71;" aria-hidden="true"></div>
                    <div class="legend-label">C√¥ng tr√¨nh c√¥ng nghi·ªáp</div>
                </div>
            </section>

            <!-- Province Info Panel -->
            <section class="province-info" id="provinceInfo" role="dialog" aria-labelledby="provinceName" aria-hidden="true">
                <div class="province-header">
                    <h2 class="province-name" id="provinceName">T√™n t·ªânh</h2>
                    <button class="close-btn" id="closeProvinceInfo" aria-label="ƒê√≥ng th√¥ng tin t·ªânh">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="province-stats" aria-label="Th·ªëng k√™ t·ªânh">
                    <div class="province-stat">
                        <div class="province-stat-value" id="provinceProjectCount" aria-live="polite">0</div>
                        <div class="province-stat-label">C√¥ng tr√¨nh</div>
                    </div>
                    <div class="province-stat">
                        <div class="province-stat-value" id="provinceArea" aria-live="polite">0</div>
                        <div class="province-stat-label">Di·ªán t√≠ch (km¬≤)</div>
                    </div>
                    <div class="province-stat">
                        <div class="province-stat-value" id="provincePopulation" aria-live="polite">0</div>
                        <div class="province-stat-label">D√¢n s·ªë (tri·ªáu)</div>
                    </div>
                    <div class="province-stat">
                        <div class="province-stat-value" id="provinceGDP" aria-live="polite">0</div>
                        <div class="province-stat-label">GDP (t·ª∑ USD)</div>
                    </div>
                </div>

                <h3 class="projects-title">
                    <i class="fas fa-list-ul" aria-hidden="true"></i> C√¥ng tr√¨nh trong t·ªânh
                </h3>
                <div id="provinceProjectsList" role="list" aria-label="Danh s√°ch c√¥ng tr√¨nh trong t·ªânh">
                    <!-- Province projects will be populated by JavaScript -->
                </div>
            </section>

            <!-- Project Info Panel -->
            <section class="project-info" id="projectInfo" role="dialog" aria-labelledby="projectInfoTitle" aria-hidden="true">
                <div class="info-header">
                    <h2 class="info-title" id="projectInfoTitle">T√™n c√¥ng tr√¨nh</h2>
                    <button class="close-btn" id="closeInfo" aria-label="ƒê√≥ng th√¥ng tin c√¥ng tr√¨nh">
            <i class="fas fa-times"></i>
        </button>
                </div>

                <div class="info-grid" aria-label="Chi ti·∫øt c√¥ng tr√¨nh">
                    <!-- T·ªânh/Th√†nh ph·ªë -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-map-marker-alt"></i>T·ªânh/Th√†nh ph·ªë
            </dt>
                        <dd class="info-value" id="infoProvince">-</dd>
                    </div>

                    <!-- ƒê·ªãa ch·ªâ -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-location-dot"></i>ƒê·ªãa ch·ªâ
            </dt>
                        <dd class="info-value" id="infoAddress">-</dd>
                    </div>

                    <!-- Ch·ªß ƒë·∫ßu t∆∞ -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-building"></i>Ch·ªß ƒë·∫ßu t∆∞
            </dt>
                        <dd class="info-value" id="infoInvestor">-</dd>
                    </div>

                    <!-- NƒÉm ho√†n th√†nh -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-calendar-alt"></i>NƒÉm ho√†n th√†nh
            </dt>
                        <dd class="info-value" id="infoYear">-</dd>
                    </div>

                    <!-- Quy m√¥ -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-ruler-combined"></i>Quy m√¥
            </dt>
                        <dd class="info-value" id="infoScale">-</dd>
                    </div>

                    <!-- T·ªça ƒë·ªô -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-crosshairs"></i>T·ªça ƒë·ªô
            </dt>
                        <dd class="info-value" id="infoCoordinates">-</dd>
                    </div>

                    <!-- M√¥ t·∫£ (th√™m m·ªõi) -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-file-alt"></i>M√¥ t·∫£
            </dt>
                        <dd class="info-value" id="infoDescription">-</dd>
                    </div>

                    <!-- Ng√¢n s√°ch (th√™m m·ªõi) -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-money-bill-wave"></i>Ng√¢n s√°ch
            </dt>
                        <dd class="info-value" id="infoBudget">-</dd>
                    </div>

                    <!-- Tr·∫°ng th√°i (th√™m m·ªõi) -->
                    <div class="info-item">
                        <dt class="info-label">
                <i class="fas fa-tasks"></i>Tr·∫°ng th√°i
            </dt>
                        <dd class="info-value">
                            <span class="status-badge" id="infoStatus">-</span>
                        </dd>
                    </div>
                </div>

                <!-- PH·∫¶N H√åNH ·∫¢NH D·ª∞ √ÅN -->
                <div class="project-images-section">
                    <div class="images-header">
                        <div class="info-label">
                            <i class="fas fa-images"></i>H√¨nh ·∫£nh d·ª± √°n
                        </div>
                        <div class="images-update-date" id="imagesUpdateDate">
                            C·∫≠p nh·∫≠t: <span id="updateDateText">-</span>
                        </div>
                    </div>
                    <div class="images-preview" id="imagesPreview">
                        <!-- ·∫¢nh s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                    </div>
                    <div class="no-images-message" id="noImagesMessage">
                        <i class="fas fa-image"></i>
                        <p>Ch∆∞a c√≥ h√¨nh ·∫£nh cho d·ª± √°n n√†y</p>
                    </div>
                </div>
            </section>
        </main>
    </div>


    <!-- Quick View Modal -->
    <div class="quick-view-modal" id="quickViewModal">
        <!-- Content will be populated by JavaScript -->
    </div>

    <!-- No Script Fallback -->
    <noscript>
        <div class="noscript-warning" style="padding: 20px; text-align: center; background: #f8d7da; color: #721c24;">
            <h2>JavaScript b·ªã v√¥ hi·ªáu h√≥a</h2>
            <p>·ª®ng d·ª•ng b·∫£n ƒë·ªì y√™u c·∫ßu JavaScript ƒë·ªÉ ho·∫°t ƒë·ªông. Vui l√≤ng b·∫≠t JavaScript trong tr√¨nh duy·ªát c·ªßa b·∫°n.</p>
        </div>
    </noscript>

    <!-- Screen Reader Only Text -->
    <div class="sr-only" id="srAnnouncements" aria-live="polite" aria-atomic="true"></div>

    <!-- Main JavaScript -->
    <script src="Codebando.js"></script>
    <script src="main.js"></script>

    <!-- Image Manager Modal -->
    <div id="imageModal" class="image-manager-modal" style="display:none;">
        <div class="image-modal-overlay"></div>
        <div class="image-modal-container">
            <div class="image-modal-header">
                <h3 class="image-modal-title"><i class="fas fa-images"></i> Qu·∫£n l√Ω ·∫£nh c√¥ng tr√¨nh</h3>
                <button class="image-modal-close" onclick="imageUI.closeImageManager()" aria-label="ƒê√≥ng modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="image-upload-section">
                <div class="upload-field">
                    <label for="imagePath"><i class="fas fa-link"></i> ƒê∆∞·ªùng d·∫´n file ·∫£nh:</label>
                    <input type="text" id="imagePath" placeholder="VD: images/projects/landmark-81-1.jpg" class="image-path-input">
                </div>
                <div class="upload-buttons">
                    <button id="uploadImageBtn" class="upload-btn-primary"><i class="fas fa-upload"></i> Th√™m ·∫£nh</button>
                    <button onclick="document.getElementById('imageFileInput').click()" class="upload-btn-secondary"><i class="fas fa-folder-open"></i> Ch·ªçn file</button>
                    <input type="file" id="imageFileInput" accept="image/*" style="display:none;">
                </div>
            </div>

            <div class="image-gallery-section">
                <h4><i class="fas fa-image"></i> B·ªô s∆∞u t·∫≠p ·∫£nh</h4>
                <div id="imageGalleryContainer" class="image-gallery-grid"></div>
            </div>
        </div>
    </div>

    <script>
        // Handle image modal interactions
        const imageModal = document.getElementById('imageModal');
        if (imageModal) {
            imageModal.addEventListener('click', (e) => {
                if (e.target.id === 'imageModal' || e.target.classList.contains('image-modal-overlay')) {
                    imageUI.closeImageManager();
                }
            });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('imageModal');
                if (modal && modal.style.display !== 'none') {
                    imageUI.closeImageManager();
                }
            }
        });

        // Handle theme toggle
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                const html = document.documentElement;
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                themeToggle.querySelector('i').className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            });
        }

        // Restore theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
    <div id="comparisonModal" class="comparison-modal" style="display:none;">
        <div class="comparison-overlay"></div>
        <div class="comparison-container">
            <div class="comparison-header">
                <h2><i class="fas fa-balance-scale"></i> So S√°nh C√¥ng Tr√¨nh</h2>
                <button class="close-comparison" onclick="comparisonManager.closeComparison()">
                <i class="fas fa-times"></i>
            </button>
            </div>

            <div class="comparison-controls">
                <div class="comparison-select">
                    <label>Th√™m c√¥ng tr√¨nh:</label>
                    <select id="comparisonSelect" class="comparison-dropdown">
                    <option value="">-- Ch·ªçn c√¥ng tr√¨nh --</option>
                </select>
                    <button id="addComparisonBtn" class="btn-add-comparison">
                    <i class="fas fa-plus"></i> Th√™m
                </button>
                </div>
                <button class="btn-clear-comparison" onclick="comparisonManager.clearComparison()">
                <i class="fas fa-trash"></i> X√≥a t·∫•t c·∫£
            </button>
            </div>

            <div class="comparison-content">
                <table class="comparison-table" id="comparisonTable">
                    <thead>
                        <tr id="comparisonTableHead">
                            <th style="width: 200px;">Th√¥ng tin</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonTableBody">
                    </tbody>
                </table>
            </div>

            <div class="comparison-footer">
                <button class="btn-export-comparison" onclick="comparisonManager.exportComparison()">
                <i class="fas fa-download"></i> T·∫£i xu·ªëng
            </button>
                <button class="btn-close-modal" onclick="comparisonManager.closeComparison()">
                ƒê√≥ng
            </button>
            </div>
        </div>
    </div>

    <!-- N√∫t m·ªü modal so s√°nh (th√™m v√†o sidebar n·∫øu c·∫ßn) -->
    <!-- ===== ADVANCED STATISTICS DASHBOARD ===== -->
    <div id="statsDashboard" class="stats-dashboard" style="display:none;">
        <div class="stats-overlay" onclick="dashboardManager.closeDashboard()"></div>
        <div class="stats-container">
            <!-- Header -->
            <div class="stats-header">
                <h2><i class="fas fa-chart-bar"></i> Dashboard Th·ªëng K√™ C√¥ng Tr√¨nh</h2>
                <button class="close-stats" onclick="dashboardManager.closeDashboard()">
                <i class="fas fa-times"></i>
            </button>
            </div>

            <!-- KPI Cards -->
            <div class="stats-kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-icon">üìä</div>
                    <div class="kpi-value" id="kpiTotal">0</div>
                    <div class="kpi-label">T·ªïng C√¥ng Tr√¨nh</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üó∫Ô∏è</div>
                    <div class="kpi-value" id="kpiProvinces">0</div>
                    <div class="kpi-label">T·ªânh/TP</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üèóÔ∏è</div>
                    <div class="kpi-value" id="kpiCommercial">0</div>
                    <div class="kpi-label">Th∆∞∆°ng M·∫°i</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üõ£Ô∏è</div>
                    <div class="kpi-value" id="kpiTransport">0</div>
                    <div class="kpi-label">Giao Th√¥ng</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üè≠</div>
                    <div class="kpi-value" id="kpiIndustrial">0</div>
                    <div class="kpi-label">C√¥ng Nghi·ªáp</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="stats-charts-grid">
                <!-- Chart 1: Pie Chart - Lo·∫°i C√¥ng Tr√¨nh -->
                <div class="chart-container">
                    <h3>Ph√¢n B·ªë Theo Lo·∫°i</h3>
                    <canvas id="chartTypeDistribution"></canvas>
                </div>

                <!-- Chart 2: Bar Chart - C√¥ng Tr√¨nh Theo NƒÉm -->
                <div class="chart-container">
                    <h3>Xu H∆∞·ªõng Theo NƒÉm</h3>
                    <canvas id="chartByYear"></canvas>
                </div>

                <!-- Chart 3: Top Provinces -->
                <div class="chart-container">
                    <h3>Top 10 T·ªânh/TP</h3>
                    <canvas id="chartTopProvinces"></canvas>
                </div>

                <!-- Chart 4: Status Distribution -->
                <div class="chart-container">
                    <h3>Ph√¢n B·ªë Tr·∫°ng Th√°i</h3>
                    <canvas id="chartStatus"></canvas>
                </div>
            </div>

            <!-- Detailed Table -->
            <div class="stats-table-section">
                <h3>Top 10 Nh√† ƒê·∫ßu T∆∞</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Nh√† ƒê·∫ßu T∆∞</th>
                            <th>S·ªë D·ª± √Ån</th>
                            <th>Lo·∫°i C√¥ng Tr√¨nh</th>
                        </tr>
                    </thead>
                    <tbody id="topInvestorsTable">
                        <!-- JS s·∫Ω render -->
                    </tbody>
                </table>
            </div>

            <!-- Footer -->
            <div class="stats-footer">
                <button class="btn-export-stats" onclick="dashboardManager.exportDashboard()">
                <i class="fas fa-download"></i> T·∫£i Xu·ªëng
            </button>
                <button class="btn-refresh-stats" onclick="dashboardManager.refreshStats()">
                <i class="fas fa-sync-alt"></i> L√†m M·ªõi
            </button>
                <button class="btn-close-stats" onclick="dashboardManager.closeDashboard()">
                ƒê√≥ng
            </button>
            </div>
        </div>
    </div>

    <!-- ===== FORM & DATA ENTRY MODAL ===== -->
    <div id="dataEntryModal" class="data-entry-modal" style="display:none;">
        <div class="data-entry-overlay" onclick="formManager.closeForm()"></div>
        <div class="data-entry-container">
            <!-- Header -->
            <div class="data-entry-header">
                <h2 id="formTitle">‚ûï Th√™m D·ª± √Ån M·ªõi</h2>
                <button class="close-form" onclick="formManager.closeForm()">
                <i class="fas fa-times"></i>
            </button>
            </div>

            <!-- Form Content -->
            <form id="projectForm" class="project-form">
                <!-- Section 1: Th√¥ng Tin C∆° B·∫£n -->
                <fieldset class="form-section">
                    <legend>üìã Th√¥ng Tin C∆° B·∫£n</legend>

                    <div class="form-group">
                        <label for="projectName">T√™n D·ª± √Ån *</label>
                        <input type="text" id="projectName" name="name" placeholder="Nh·∫≠p t√™n d·ª± √°n" required>
                        <span class="form-error" id="nameError"></span>
                    </div>

                    <div class="form-group">
                        <label for="projectType">Lo·∫°i C√¥ng Tr√¨nh *</label>
                        <select id="projectType" name="type" required>
                        <option value="">-- Ch·ªçn lo·∫°i --</option>
                        <option value="commercial">üèóÔ∏è Th∆∞∆°ng M·∫°i</option>
                        <option value="transport">üõ£Ô∏è Giao Th√¥ng</option>
                        <option value="industrial">üè≠ C√¥ng Nghi·ªáp</option>
                    </select>
                        <span class="form-error" id="typeError"></span>
                    </div>

                    <div class="form-group">
                        <label for="projectProvince">T·ªânh/Th√†nh Ph·ªë *</label>
                        <select id="projectProvince" name="province" required>
                        <option value="">-- Ch·ªçn t·ªânh --</option>
                        <option value="H√† N·ªôi">H√† N·ªôi</option>
                        <option value="TP. H·ªì Ch√≠ Minh">TP. H·ªì Ch√≠ Minh</option>
                        <option value="ƒê√† N·∫µng">ƒê√† N·∫µng</option>
                        <option value="H·∫£i Ph√≤ng">H·∫£i Ph√≤ng</option>
                        <option value="C·∫ßn Th∆°">C·∫ßn Th∆°</option>
                        <option value="Kh√°c">Kh√°c</option>
                    </select>
                        <span class="form-error" id="provinceError"></span>
                    </div>

                    <div class="form-group">
                        <label for="projectYear">NƒÉm *</label>
                        <input type="number" id="projectYear" name="year" placeholder="2024" min="2000" max="2099" required>
                        <span class="form-error" id="yearError"></span>
                    </div>

                    <div class="form-group">
                        <label for="projectStatus">Tr·∫°ng Th√°i *</label>
                        <select id="projectStatus" name="status" required>
                        <option value="">-- Ch·ªçn tr·∫°ng th√°i --</option>
                        <option value="planned">üìã Quy Ho·∫°ch</option>
                        <option value="in-progress">üöß ƒêang X√¢y</option>
                        <option value="completed">‚úÖ Ho√†n Th√†nh</option>
                    </select>
                        <span class="form-error" id="statusError"></span>
                    </div>
                </fieldset>

                <!-- Section 2: ƒê·ªãa Ch·ªâ & V·ªã Tr√≠ -->
                <fieldset class="form-section">
                    <legend>üìç ƒê·ªãa Ch·ªâ & V·ªã Tr√≠</legend>

                    <div class="form-group">
                        <label for="projectAddress">ƒê·ªãa Ch·ªâ *</label>
                        <input type="text" id="projectAddress" name="address" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ c·ª• th·ªÉ" required>
                        <span class="form-error" id="addressError"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectLat">Vƒ© ƒê·ªô (Latitude)</label>
                            <input type="number" id="projectLat" name="lat" placeholder="10.7769" step="0.0001">
                            <span class="form-error" id="latError"></span>
                        </div>
                        <div class="form-group">
                            <label for="projectLng">Kinh ƒê·ªô (Longitude)</label>
                            <input type="number" id="projectLng" name="lng" placeholder="106.7009" step="0.0001">
                            <span class="form-error" id="lngError"></span>
                        </div>
                    </div>

                    <button type="button" class="btn-pick-location" onclick="formManager.pickLocationFromMap()">
                    <i class="fas fa-map-marker-alt"></i> Ch·ªçn V·ªã Tr√≠ T·ª´ B·∫£n ƒê·ªì
                </button>
                </fieldset>

                <!-- Section 3: Th√¥ng Tin Chi Ti·∫øt -->
                <fieldset class="form-section">
                    <legend>üíº Th√¥ng Tin Chi Ti·∫øt</legend>

                    <div class="form-group">
                        <label for="projectInvestor">Nh√† ƒê·∫ßu T∆∞ *</label>
                        <input type="text" id="projectInvestor" name="investor" placeholder="T√™n c√¥ng ty/t·ªï ch·ª©c" required>
                        <span class="form-error" id="investorError"></span>
                    </div>

                    <div class="form-group">
                        <label for="projectScale">Quy M√¥</label>
                        <input type="text" id="projectScale" name="scale" placeholder="VD: 50 ha, 100,000 m¬≤">
                    </div>

                    <div class="form-group">
                        <label for="projectBudget">Ng√¢n S√°ch (t·ª∑ ƒë·ªìng)</label>
                        <input type="number" id="projectBudget" name="budget" placeholder="1000" step="0.1">
                    </div>

                    <div class="form-group">
                        <label for="projectDescription">M√¥ T·∫£</label>
                        <textarea id="projectDescription" name="description" placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt..." rows="4"></textarea>
                    </div>
                </fieldset>

                <!-- Section 4: Upload ·∫¢nh -->
                <fieldset class="form-section">
                    <legend>üñºÔ∏è H√¨nh ·∫¢nh & T√†i Li·ªáu</legend>

                    <div class="form-group">
                        <label>Upload ·∫¢nh (Drag & Drop ho·∫∑c Click)</label>
                        <div class="image-upload-zone" id="imageUploadZone">
                            <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                            <p>K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c <strong>click ƒë·ªÉ ch·ªçn</strong></p>
                            <input type="file" id="projectImages" name="images" accept="image/*" multiple style="display:none;">
                        </div>
                        <div id="imagePreview" class="image-preview"></div>
                    </div>
                </fieldset>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> L∆∞u D·ª± √Ån
                </button>
                    <button type="reset" class="btn-reset">
                    <i class="fas fa-redo"></i> ƒê·∫∑t L·∫°i
                </button>
                    <button type="button" class="btn-cancel" onclick="formManager.closeForm()">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
                </div>
            </form>
        </div>
    </div>
    <!-- ===== ROUTE PLANNING & DISTANCE CALCULATOR MODAL ƒë·ªãnh v·ªã ƒëo kho·∫£ng c√°ch ===== -->
    <div id="routePlanningModal" class="route-planning-modal" style="display:none;">
        <div class="route-overlay" onclick="routeManager.closeRoutePanel()"></div>
        <div class="route-container">
            <!-- Header -->
            <div class="route-header">
                <h2><i class="fas fa-road"></i> T√≠nh To√°n Tuy·∫øn ƒê∆∞·ªùng</h2>
                <button class="close-route" onclick="routeManager.closeRoutePanel()">
                <i class="fas fa-times"></i>
            </button>
            </div>

            <!-- Route Controls -->
            <div class="route-controls">
                <div class="route-input-group">
                    <label>ƒêi·ªÉm Xu·∫•t Ph√°t:</label>
                    <div class="route-input-wrapper">
                        <select id="routeFromSelect" class="route-select">
                        <option value="">-- Ch·ªçn c√¥ng tr√¨nh --</option>
                    </select>
                        <button class="btn-pick-from-map" onclick="routeManager.pickFromMap()" title="Ch·ªçn t·ª´ b·∫£n ƒë·ªì">
                        <i class="fas fa-map-pin"></i>
                    </button>
                    </div>
                    <div id="routeFromCoords" class="route-coords">
                        <small>T·ªça ƒë·ªô: <span id="fromCoordsText">-</span></small>
                    </div>
                </div>

                <button class="btn-swap-route" onclick="routeManager.swapRoutePoints()" title="Ho√°n ƒë·ªïi ƒëi·ªÉm">
                <i class="fas fa-arrows-alt-v"></i>
            </button>

                <div class="route-input-group">
                    <label>ƒêi·ªÉm ƒê√≠ch:</label>
                    <div class="route-input-wrapper">
                        <select id="routeToSelect" class="route-select">
                        <option value="">-- Ch·ªçn c√¥ng tr√¨nh --</option>
                    </select>
                        <button class="btn-pick-to-map" onclick="routeManager.pickToMap()" title="Ch·ªçn t·ª´ b·∫£n ƒë·ªì">
                        <i class="fas fa-map-pin"></i>
                    </button>
                    </div>
                    <div id="routeToCoords" class="route-coords">
                        <small>T·ªça ƒë·ªô: <span id="toCoordsText">-</span></small>
                    </div>
                </div>
            </div>

            <!-- Route Mode Selection -->
            <div class="route-mode-selector">
                <label>Ch·∫ø ƒê·ªô Di Chuy·ªÉn:</label>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="driving" onclick="routeManager.setMode('driving')">
                    <i class="fas fa-car"></i> Xe H∆°i
                </button>
                    <button class="mode-btn" data-mode="walking" onclick="routeManager.setMode('walking')">
                    <i class="fas fa-person-walking"></i> ƒêi B·ªô
                </button>
                    <button class="mode-btn" data-mode="cycling" onclick="routeManager.setMode('cycling')">
                    <i class="fas fa-bicycle"></i> Xe ƒê·∫°p
                </button>
                </div>
            </div>

            <!-- Route Options -->
            <div class="route-options">
                <label class="checkbox-option">
                <input type="checkbox" id="routeAvoidTolls" name="avoidTolls">
                <span>Tr√°nh ƒë∆∞·ªùng c·∫ßu ph√≠</span>
            </label>
                <label class="checkbox-option">
                <input type="checkbox" id="routeAvoidMotorway" name="avoidMotorway">
                <span>Tr√°nh ƒë∆∞·ªùng cao t·ªëc</span>
            </label>
                <label class="checkbox-option">
                <input type="checkbox" id="routeShowAlternatives" name="alternatives" checked>
                <span>Hi·ªÉn th·ªã c√°c tuy·∫øn thay th·∫ø</span>
            </label>
            </div>

            <!-- Calculate Button -->
            <button class="btn-calculate-route" onclick="routeManager.calculateRoute()">
            <i class="fas fa-calculator"></i> T√≠nh To√°n Tuy·∫øn ƒê∆∞·ªùng
        </button>

            <!-- Route Results -->
            <div class="route-results" id="routeResults" style="display:none;">
                <div class="results-header">
                    <h3>K·∫øt Qu·∫£ Tuy·∫øn ƒê∆∞·ªùng</h3>
                </div>

                <!-- Primary Route Info -->
                <div class="route-info-card primary">
                    <div class="route-info-title">
                        <i class="fas fa-route"></i> Tuy·∫øn Ch√≠nh
                    </div>
                    <div class="route-info-grid">
                        <div class="info-row">
                            <span class="info-label">Kho·∫£ng C√°ch:</span>
                            <span class="info-value" id="routeDistance">0 km</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Th·ªùi Gian:</span>
                            <span class="info-value" id="routeDuration">0 ph√∫t</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">T·ªëc ƒê·ªô TB:</span>
                            <span class="info-value" id="routeAvgSpeed">0 km/h</span>
                        </div>
                    </div>
                </div>

                <!-- Alternative Routes -->
                <div class="alternative-routes" id="alternativeRoutes" style="display:none;">
                    <h4>Tuy·∫øn Thay Th·∫ø:</h4>
                    <div id="alternativeRoutesList"></div>
                </div>

                <!-- Route Steps (Directions) -->
                <div class="route-directions">
                    <h4>
                        <i class="fas fa-list-ol"></i> H∆∞·ªõng D·∫´n Chi Ti·∫øt
                    </h4>
                    <div class="directions-list" id="directionsList">
                        <!-- Steps will be populated here -->
                    </div>
                </div>

                <!-- Route Actions -->
                <div class="route-actions">
                    <button class="btn-export-route" onclick="routeManager.exportRoute()">
                    <i class="fas fa-download"></i> T·∫£i Xu·ªëng
                </button>
                    <button class="btn-save-route" onclick="routeManager.saveRoute()">
                    <i class="fas fa-bookmark"></i> L∆∞u Tuy·∫øn ƒê∆∞·ªùng
                </button>
                    <button class="btn-print-route" onclick="window.print()">
                    <i class="fas fa-print"></i> In
                </button>
                    <button class="btn-share-route" onclick="routeManager.shareRoute()">
                    <i class="fas fa-share"></i> Chia S·∫ª
                </button>
                </div>
            </div>

            <!-- Saved Routes List -->
            <div class="saved-routes-section">
                <h4>
                    <i class="fas fa-history"></i> Tuy·∫øn ƒê∆∞·ªùng ƒê√£ L∆∞u
                </h4>
                <div id="savedRoutesList" class="saved-routes-list">
                    <p class="no-saved">Ch∆∞a c√≥ tuy·∫øn ƒë∆∞·ªùng ƒë∆∞·ª£c l∆∞u</p>
                </div>
            </div>

            <!-- Close Button -->
            <div class="route-footer">
                <button class="btn-close-route" onclick="routeManager.closeRoutePanel()">
                ƒê√≥ng
            </button>
            </div>
        </div>
    </div>
    <div id="user-panel" style="position: absolute; top: 10px; right: 10px; z-index: 1000; background: white; padding: 8px 15px; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
        <span id="username-display" style="margin-right: 10px;"></span>
        <button onclick="logout()" style="padding: 5px 10px; background: #1a73e8; color: white; border: none; border-radius: 3px; cursor: pointer;">
        ƒêƒÉng xu·∫•t
    </button>
    </div>

    <script>
        // Hi·ªÉn th·ªã t√™n ng∆∞·ªùi d√πng
        document.getElementById('username-display').textContent = localStorage.getItem('username') || 'Ng∆∞·ªùi d√πng';

        // H√†m ƒëƒÉng xu·∫•t
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('username');
            window.location.href = 'login.html';
        }
    </script>

</body>

</html>